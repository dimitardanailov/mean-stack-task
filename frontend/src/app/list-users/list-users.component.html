<section [className]="'page-holder'">
  <div [className]="'page-title'">Database users</div>
  <form [formGroup]="form" (ngSubmit)="filterData()">
    <section class="form-filters">
      <mat-form-field [className]="'form-filter-field'">
        <mat-label>Role: </mat-label>
        <mat-select name="role" formControlName="role" (change)="filterData()">
          <mat-option [value]="item.key" *ngFor="let item of positions">
            {{ item.value }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field [className]="'form-filter-field'">
        <input
          matInput
          placeholder="First name"
          type="text"
          formControlName="firstName"
          (focusout)="filterData()"
        />
      </mat-form-field>

      <mat-form-field [className]="'form-filter-field'">
        <input
          matInput
          placeholder="Last Name"
          type="text"
          formControlName="lastName"
        />
      </mat-form-field>

      <mat-form-field [className]="'form-filter-field'">
        <input
          matInput
          placeholder="Email"
          type="email"
          formControlName="email"
        />
      </mat-form-field>

      <section [className]="'form-filter-field'">
        <button type="submit">Filter</button>
      </section>
    </section>
  </form>

  <section [className]="'table'">
    <section [className]="'table-header'">
      <div
        *ngFor="let column of displayedColumns"
        [className]="'table-header-column'"
      >
        {{ column }}
      </div>
    </section>

    <section [className]="'table-body'">
      <section *ngFor="let user of users">
        <section
          [className]="
            user.isVisible
              ? 'table-body-row table-body-row-visible'
              : 'table-body-row table-body-row-hidden'
          "
        >
          <section [className]="'table-body-item'">
            {{ user.firstName }}
          </section>
          <section [className]="'table-body-item'">
            {{ user.lastName }}
          </section>
          <section [className]="'table-body-item'">
            {{ user.email }}
          </section>
          <section [className]="'table-body-item'">
            {{ roles.get(user.role) }}
          </section>
          <section [className]="'table-body-item'">
            <section [className]="'operations'">
              <div [className]="'operation-update'">
                <mat-icon aria-hidden="false" aria-label="Edit edit icon"
                  >edit</mat-icon
                >
              </div>
              <div [className]="'operation-remove'">
                <mat-icon
                  aria-hidden="false"
                  aria-label="Remove delete icon"
                  (click)="deleteRow(user.email)"
                  >delete</mat-icon
                >
              </div>
            </section>
          </section>
        </section>
      </section>
    </section>
  </section>

  <table mat-table [dataSource]="users" class="mat-elevation-z8">
    <!-- First name column -->
    <ng-container matColumnDef="firstName">
      <th mat-header-cell *matHeaderCellDef>First Name</th>
      <td mat-cell *matCellDef="let element">
        {{ element.firstName }}
      </td>
    </ng-container>

    <!-- Last Name Column -->
    <ng-container matColumnDef="lastName">
      <th mat-header-cell *matHeaderCellDef>LastName</th>
      <td mat-cell *matCellDef="let element">{{ element.lastName }}</td>
    </ng-container>

    <!-- Email Column -->
    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let element">{{ element.email }}</td>
    </ng-container>

    <!-- Role Column -->
    <ng-container matColumnDef="role">
      <th mat-header-cell *matHeaderCellDef>Role</th>
      <td mat-cell *matCellDef="let element">{{ roles.get(element.role) }}</td>
    </ng-container>

    <!-- Remove Column -->
    <ng-container matColumnDef="operations">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <section [className]="'operations'">
          <div [className]="'operation-update'">
            <mat-icon aria-hidden="false" aria-label="Edit edit icon"
              >edit</mat-icon
            >
          </div>
          <div [className]="'operation-remove'">
            <mat-icon
              aria-hidden="false"
              aria-label="Remove delete icon"
              (click)="deleteRow(element.email)"
              >delete</mat-icon
            >
          </div>
        </section>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</section>
